`timescale 1ns/1ps

module brent_kung_adder_256_mode0_only (
    input  logic [255:0] A,
    input  logic [255:0] B,
    input  logic [1:0]   word_mode,   // 00: scalar, 01: vec32, 10: vec16
    input  logic         cin,
    output logic [255:0] sum,
    output logic         cout
);

    logic [255:0] G, P;
    logic [256:0] C;

    // Step 1: Bitwise G/P
    genvar i;
    generate
        for (i = 0; i < 256; i++) begin : gp_gen
            assign G[i] = A[i] & B[i];
            assign P[i] = A[i] ^ B[i];
        end
    endgenerate

    // Step 2: Up-sweep: compute group prefixes at sparse nodes
    // Tree level wires
    logic [255:0] G1, G2, G3, G4, G5, G6, G7, G8;
    logic [255:0] P1, P2, P3, P4, P5, P6, P7;

    // Level 1 (distance 1)
    generate
        for (i = 0; i < 256; i++) begin
            if (i >= 1 && (i & 1) == 1) begin
                assign G1[i] = G[i] | (P[i] & G[i-1]);
                assign P1[i] = P[i] & P[i-1];
            end else begin
                assign G1[i] = G[i];
                assign P1[i] = P[i];
            end
        end
    endgenerate

    // Level 2 (distance 2)
    generate
        for (i = 0; i < 256; i++) begin
            if (i >= 3 && (i & 3) == 3) begin
                assign G2[i] = G1[i] | (P1[i] & G1[i-2]);
                assign P2[i] = P1[i] & P1[i-2];
            end else begin
                assign G2[i] = G1[i];
                assign P2[i] = P1[i];
            end
        end
    endgenerate

    // Level 3 (distance 4)
    generate
        for (i = 0; i < 256; i++) begin
            if (i >= 7 && (i & 7) == 7) begin
                assign G3[i] = G2[i] | (P2[i] & G2[i-4]);
                assign P3[i] = P2[i] & P2[i-4];
            end else begin
                assign G3[i] = G2[i];
                assign P3[i] = P2[i];
            end
        end
    endgenerate

    // Level 4 (distance 8)
    generate
        for (i = 0; i < 256; i++) begin
            if (i >= 15 && (i & 15) == 15) begin
                assign G4[i] = G3[i] | (P3[i] & G3[i-8]);
                assign P4[i] = P3[i] & P3[i-8];
            end else begin
                assign G4[i] = G3[i];
                assign P4[i] = P3[i];
            end
        end
    endgenerate

    // Level 5 (distance 16)
    generate
        for (i = 0; i < 256; i++) begin
            if (i >= 31 && (i & 31) == 31) begin
                assign G5[i] = G4[i] | (P4[i] & G4[i-16]);
                assign P5[i] = P4[i] & P4[i-16];
            end else begin
                assign G5[i] = G4[i];
                assign P5[i] = P4[i];
            end
        end
    endgenerate

    // Level 6 (distance 32)
    generate
        for (i = 0; i < 256; i++) begin
            if (i >= 63 && (i & 63) == 63) begin
                assign G6[i] = G5[i] | (P5[i] & G5[i-32]);
                assign P6[i] = P5[i] & P5[i-32];
            end else begin
                assign G6[i] = G5[i];
                assign P6[i] = P5[i];
            end
        end
    endgenerate

    // Level 7 (distance 64)
    generate
        for (i = 0; i < 256; i++) begin
            if (i >= 127 && (i & 127) == 127) begin
                assign G7[i] = G6[i] | (P6[i] & G6[i-64]);
                assign P7[i] = P6[i] & P6[i-64];
            end else begin
                assign G7[i] = G6[i];
                assign P7[i] = P6[i];
            end
        end
    endgenerate

    // Level 8 (distance 128, final G only)
    generate
        for (i = 0; i < 256; i++) begin
            if (i == 255) begin
                assign G8[i] = G7[i] | (P7[i] & G7[i-128]);
            end else begin
                assign G8[i] = G7[i];
            end
        end
    endgenerate

    // Step 3: Down-sweep â€” assign carries using prefix fanout
    always_comb begin
        C[0] = cin;
        C[1] = G[0] | (P[0] & C[0]);
        C[2] = G2[1] | (P2[1] & C[0]);
        C[3] = G1[2] | (P1[2] & C[2]);
        C[4] = G3[3] | (P3[3] & C[0]);
        C[5] = G1[4] | (P1[4] & C[4]);
        C[6] = G2[5] | (P2[5] & C[4]);
        C[7] = G1[6] | (P1[6] & C[6]);
        C[8] = G4[7] | (P4[7] & C[0]);
        C[9] = G1[8] | (P1[8] & C[8]);
        C[10] = G2[9] | (P2[9] & C[8]);
        C[11] = G1[10] | (P1[10] & C[10]);
        C[12] = G3[11] | (P3[11] & C[8]);
        C[13] = G1[12] | (P1[12] & C[12]);
        C[14] = G2[13] | (P2[13] & C[12]);
        C[15] = G1[14] | (P1[14] & C[14]);
        C[16] = G5[15] | (P5[15] & C[0]);
        C[17] = G1[16] | (P1[16] & C[16]);
        C[18] = G2[17] | (P2[17] & C[16]);
        C[19] = G1[18] | (P1[18] & C[18]);
        C[20] = G3[19] | (P3[19] & C[16]);
        C[21] = G1[20] | (P1[20] & C[20]);
        C[22] = G2[21] | (P2[21] & C[20]);
        C[23] = G1[22] | (P1[22] & C[22]);
        C[24] = G4[23] | (P4[23] & C[16]);
        C[25] = G1[24] | (P1[24] & C[24]);
        C[26] = G2[25] | (P2[25] & C[24]);
        C[27] = G1[26] | (P1[26] & C[26]);
        C[28] = G3[27] | (P3[27] & C[24]);
        C[29] = G1[28] | (P1[28] & C[28]);
        C[30] = G2[29] | (P2[29] & C[28]);
        C[31] = G1[30] | (P1[30] & C[30]);
        C[32] = G6[31] | (P6[31] & C[0]);
        C[33] = G1[32] | (P1[32] & C[32]);
        C[34] = G2[33] | (P2[33] & C[32]);
        C[35] = G1[34] | (P1[34] & C[34]);
        C[36] = G3[35] | (P3[35] & C[32]);
        C[37] = G1[36] | (P1[36] & C[36]);
        C[38] = G2[37] | (P2[37] & C[36]);
        C[39] = G1[38] | (P1[38] & C[38]);
        C[40] = G4[39] | (P4[39] & C[32]);
        C[41] = G1[40] | (P1[40] & C[40]);
        C[42] = G2[41] | (P2[41] & C[40]);
        C[43] = G1[42] | (P1[42] & C[42]);
        C[44] = G3[43] | (P3[43] & C[40]);
        C[45] = G1[44] | (P1[44] & C[44]);
        C[46] = G2[45] | (P2[45] & C[44]);
        C[47] = G1[46] | (P1[46] & C[46]);
        C[48] = G5[47] | (P5[47] & C[32]);
        C[49] = G1[48] | (P1[48] & C[48]);
        C[50] = G2[49] | (P2[49] & C[48]);
        C[51] = G1[50] | (P1[50] & C[50]);
        C[52] = G3[51] | (P3[51] & C[48]);
        C[53] = G1[52] | (P1[52] & C[52]);
        C[54] = G2[53] | (P2[53] & C[52]);
        C[55] = G1[54] | (P1[54] & C[54]);
        C[56] = G4[55] | (P4[55] & C[48]);
        C[57] = G1[56] | (P1[56] & C[56]);
        C[58] = G2[57] | (P2[57] & C[56]);
        C[59] = G1[58] | (P1[58] & C[58]);
        C[60] = G3[59] | (P3[59] & C[56]);
        C[61] = G1[60] | (P1[60] & C[60]);
        C[62] = G2[61] | (P2[61] & C[60]);
        C[63] = G1[62] | (P1[62] & C[62]);
        C[64] = G7[63] | (P7[63] & C[0]);
        C[65] = G1[64] | (P1[64] & C[64]);
        C[66] = G2[65] | (P2[65] & C[64]);
        C[67] = G1[66] | (P1[66] & C[66]);
        C[68] = G3[67] | (P3[67] & C[64]);
        C[69] = G1[68] | (P1[68] & C[68]);
        C[70] = G2[69] | (P2[69] & C[68]);
        C[71] = G1[70] | (P1[70] & C[70]);
        C[72] = G4[71] | (P4[71] & C[64]);
        C[73] = G1[72] | (P1[72] & C[72]);
        C[74] = G2[73] | (P2[73] & C[72]);
        C[75] = G1[74] | (P1[74] & C[74]);
        C[76] = G3[75] | (P3[75] & C[72]);
        C[77] = G1[76] | (P1[76] & C[76]);
        C[78] = G2[77] | (P2[77] & C[76]);
        C[79] = G1[78] | (P1[78] & C[78]);
        C[80] = G5[79] | (P5[79] & C[64]);
        C[81] = G1[80] | (P1[80] & C[80]);
        C[82] = G2[81] | (P2[81] & C[80]);
        C[83] = G1[82] | (P1[82] & C[82]);
        C[84] = G3[83] | (P3[83] & C[80]);
        C[85] = G1[84] | (P1[84] & C[84]);
        C[86] = G2[85] | (P2[85] & C[84]);
        C[87] = G1[86] | (P1[86] & C[86]);
        C[88] = G4[87] | (P4[87] & C[80]);
        C[89] = G1[88] | (P1[88] & C[88]);
        C[90] = G2[89] | (P2[89] & C[88]);
        C[91] = G1[90] | (P1[90] & C[90]);
        C[92] = G3[91] | (P3[91] & C[88]);
        C[93] = G1[92] | (P1[92] & C[92]);
        C[94] = G2[93] | (P2[93] & C[92]);
        C[95] = G1[94] | (P1[94] & C[94]);
        C[96] = G6[95] | (P6[95] & C[64]);
        C[97] = G1[96] | (P1[96] & C[96]);
        C[98] = G2[97] | (P2[97] & C[96]);
        C[99] = G1[98] | (P1[98] & C[98]);
        C[100] = G3[99] | (P3[99] & C[96]);
        C[101] = G1[100] | (P1[100] & C[100]);
        C[102] = G2[101] | (P2[101] & C[100]);
        C[103] = G1[102] | (P1[102] & C[102]);
        C[104] = G4[103] | (P4[103] & C[96]);
        C[105] = G1[104] | (P1[104] & C[104]);
        C[106] = G2[105] | (P2[105] & C[104]);
        C[107] = G1[106] | (P1[106] & C[106]);
        C[108] = G3[107] | (P3[107] & C[104]);
        C[109] = G1[108] | (P1[108] & C[108]);
        C[110] = G2[109] | (P2[109] & C[108]);
        C[111] = G1[110] | (P1[110] & C[110]);
        C[112] = G5[111] | (P5[111] & C[96]);
        C[113] = G1[112] | (P1[112] & C[112]);
        C[114] = G2[113] | (P2[113] & C[112]);
        C[115] = G1[114] | (P1[114] & C[114]);
        C[116] = G3[115] | (P3[115] & C[112]);
        C[117] = G1[116] | (P1[116] & C[116]);
        C[118] = G2[117] | (P2[117] & C[116]);
        C[119] = G1[118] | (P1[118] & C[118]);
        C[120] = G4[119] | (P4[119] & C[112]);
        C[121] = G1[120] | (P1[120] & C[120]);
        C[122] = G2[121] | (P2[121] & C[120]);
        C[123] = G1[122] | (P1[122] & C[122]);
        C[124] = G3[123] | (P3[123] & C[120]);
        C[125] = G1[124] | (P1[124] & C[124]);
        C[126] = G2[125] | (P2[125] & C[124]);
        C[127] = G1[126] | (P1[126] & C[126]);
        C[128] = G8[127] | (P7[127] & C[0]);
        C[129] = G1[128] | (P1[128] & C[128]);
        C[130] = G2[129] | (P2[129] & C[128]);
        C[131] = G1[130] | (P1[130] & C[130]);
        C[132] = G3[131] | (P3[131] & C[128]);
        C[133] = G1[132] | (P1[132] & C[132]);
        C[134] = G2[133] | (P2[133] & C[132]);
        C[135] = G1[134] | (P1[134] & C[134]);
        C[136] = G4[135] | (P4[135] & C[128]);
        C[137] = G1[136] | (P1[136] & C[136]);
        C[138] = G2[137] | (P2[137] & C[136]);
        C[139] = G1[138] | (P1[138] & C[138]);
        C[140] = G3[139] | (P3[139] & C[136]);
        C[141] = G1[140] | (P1[140] & C[140]);
        C[142] = G2[141] | (P2[141] & C[140]);
        C[143] = G1[142] | (P1[142] & C[142]);
        C[144] = G5[143] | (P5[143] & C[128]);
        C[145] = G1[144] | (P1[144] & C[144]);
        C[146] = G2[145] | (P2[145] & C[144]);
        C[147] = G1[146] | (P1[146] & C[146]);
        C[148] = G3[147] | (P3[147] & C[144]);
        C[149] = G1[148] | (P1[148] & C[148]);
        C[150] = G2[149] | (P2[149] & C[148]);
        C[151] = G1[150] | (P1[150] & C[150]);
        C[152] = G4[151] | (P4[151] & C[144]);
        C[153] = G1[152] | (P1[152] & C[152]);
        C[154] = G2[153] | (P2[153] & C[152]);
        C[155] = G1[154] | (P1[154] & C[154]);
        C[156] = G3[155] | (P3[155] & C[152]);
        C[157] = G1[156] | (P1[156] & C[156]);
        C[158] = G2[157] | (P2[157] & C[156]);
        C[159] = G1[158] | (P1[158] & C[158]);
        C[160] = G6[159] | (P6[159] & C[128]);
        C[161] = G1[160] | (P1[160] & C[160]);
        C[162] = G2[161] | (P2[161] & C[160]);
        C[163] = G1[162] | (P1[162] & C[162]);
        C[164] = G3[163] | (P3[163] & C[160]);
        C[165] = G1[164] | (P1[164] & C[164]);
        C[166] = G2[165] | (P2[165] & C[164]);
        C[167] = G1[166] | (P1[166] & C[166]);
        C[168] = G4[167] | (P4[167] & C[160]);
        C[169] = G1[168] | (P1[168] & C[168]);
        C[170] = G2[169] | (P2[169] & C[168]);
        C[171] = G1[170] | (P1[170] & C[170]);
        C[172] = G3[171] | (P3[171] & C[168]);
        C[173] = G1[172] | (P1[172] & C[172]);
        C[174] = G2[173] | (P2[173] & C[172]);
        C[175] = G1[174] | (P1[174] & C[174]);
        C[176] = G5[175] | (P5[175] & C[160]);
        C[177] = G1[176] | (P1[176] & C[176]);
        C[178] = G2[177] | (P2[177] & C[176]);
        C[179] = G1[178] | (P1[178] & C[178]);
        C[180] = G3[179] | (P3[179] & C[176]);
        C[181] = G1[180] | (P1[180] & C[180]);
        C[182] = G2[181] | (P2[181] & C[180]);
        C[183] = G1[182] | (P1[182] & C[182]);
        C[184] = G4[183] | (P4[183] & C[176]);
        C[185] = G1[184] | (P1[184] & C[184]);
        C[186] = G2[185] | (P2[185] & C[184]);
        C[187] = G1[186] | (P1[186] & C[186]);
        C[188] = G3[187] | (P3[187] & C[184]);
        C[189] = G1[188] | (P1[188] & C[188]);
        C[190] = G2[189] | (P2[189] & C[188]);
        C[191] = G1[190] | (P1[190] & C[190]);
        C[192] = G7[191] | (P7[191] & C[128]);
        C[193] = G1[192] | (P1[192] & C[192]);
        C[194] = G2[193] | (P2[193] & C[192]);
        C[195] = G1[194] | (P1[194] & C[194]);
        C[196] = G3[195] | (P3[195] & C[192]);
        C[197] = G1[196] | (P1[196] & C[196]);
        C[198] = G2[197] | (P2[197] & C[196]);
        C[199] = G1[198] | (P1[198] & C[198]);
        C[200] = G4[199] | (P4[199] & C[192]);
        C[201] = G1[200] | (P1[200] & C[200]);
        C[202] = G2[201] | (P2[201] & C[200]);
        C[203] = G1[202] | (P1[202] & C[202]);
        C[204] = G3[203] | (P3[203] & C[200]);
        C[205] = G1[204] | (P1[204] & C[204]);
        C[206] = G2[205] | (P2[205] & C[204]);
        C[207] = G1[206] | (P1[206] & C[206]);
        C[208] = G5[207] | (P5[207] & C[192]);
        C[209] = G1[208] | (P1[208] & C[208]);
        C[210] = G2[209] | (P2[209] & C[208]);
        C[211] = G1[210] | (P1[210] & C[210]);
        C[212] = G3[211] | (P3[211] & C[208]);
        C[213] = G1[212] | (P1[212] & C[212]);
        C[214] = G2[213] | (P2[213] & C[212]);
        C[215] = G1[214] | (P1[214] & C[214]);
        C[216] = G4[215] | (P4[215] & C[208]);
        C[217] = G1[216] | (P1[216] & C[216]);
        C[218] = G2[217] | (P2[217] & C[216]);
        C[219] = G1[218] | (P1[218] & C[218]);
        C[220] = G3[219] | (P3[219] & C[216]);
        C[221] = G1[220] | (P1[220] & C[220]);
        C[222] = G2[221] | (P2[221] & C[220]);
        C[223] = G1[222] | (P1[222] & C[222]);
        C[224] = G6[223] | (P6[223] & C[192]);
        C[225] = G1[224] | (P1[224] & C[224]);
        C[226] = G2[225] | (P2[225] & C[224]);
        C[227] = G1[226] | (P1[226] & C[226]);
        C[228] = G3[227] | (P3[227] & C[224]);
        C[229] = G1[228] | (P1[228] & C[228]);
        C[230] = G2[229] | (P2[229] & C[228]);
        C[231] = G1[230] | (P1[230] & C[230]);
        C[232] = G4[231] | (P4[231] & C[224]);
        C[233] = G1[232] | (P1[232] & C[232]);
        C[234] = G2[233] | (P2[233] & C[232]);
        C[235] = G1[234] | (P1[234] & C[234]);
        C[236] = G3[235] | (P3[235] & C[232]);
        C[237] = G1[236] | (P1[236] & C[236]);
        C[238] = G2[237] | (P2[237] & C[236]);
        C[239] = G1[238] | (P1[238] & C[238]);
        C[240] = G5[239] | (P5[239] & C[224]);
        C[241] = G1[240] | (P1[240] & C[240]);
        C[242] = G2[241] | (P2[241] & C[240]);
        C[243] = G1[242] | (P1[242] & C[242]);
        C[244] = G3[243] | (P3[243] & C[240]);
        C[245] = G1[244] | (P1[244] & C[244]);
        C[246] = G2[245] | (P2[245] & C[244]);
        C[247] = G1[246] | (P1[246] & C[246]);
        C[248] = G4[247] | (P4[247] & C[240]);
        C[249] = G1[248] | (P1[248] & C[248]);
        C[250] = G2[249] | (P2[249] & C[248]);
        C[251] = G1[250] | (P1[250] & C[250]);
        C[252] = G3[251] | (P3[251] & C[248]);
        C[253] = G1[252] | (P1[252] & C[252]);
        C[254] = G2[253] | (P2[253] & C[252]);
        C[255] = G1[254] | (P1[254] & C[254]);
        C[256] = G8[255] | (P7[255] & C[127]);
    end


    // Step 4: Final sum
    generate
        for (i = 0; i < 256; i++) begin : sum_gen
            assign sum[i] = P[i] ^ C[i];
        end
    endgenerate

    assign cout = C[256];

endmodule

